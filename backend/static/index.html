<script>
  document.getElementById('uploadForm').addEventListener('submit', async function (e) {
    e.preventDefault();
    const formData = new FormData();
    formData.append('file', document.getElementById('fileInput').files[0]);

    try {
      const response = await fetch('/upload', {
        method: 'POST',
        body: formData
      });

      if (!response.ok) {
        const errorText = await response.text();
        console.error("Upload error:", errorText);
        alert("Upload failed: " + response.status);
        return;
      }

      const data = await response.json();

      document.getElementById('summary').textContent = data.summary;
      document.getElementById('log').textContent = data.log;
      document.getElementById('forecast').textContent = data.forecast;
      document.getElementById('plot').src = data.plot_url;
      document.getElementById('plot').style.display = 'block';

    } catch (err) {
      console.error("Unexpected upload error:", err);
      alert("Upload failed: " + err.message);
    }
  });

  document.getElementById('predictForm').addEventListener('submit', async function (e) {
    e.preventDefault();
    const futureX = document.getElementById('futureInput').value;

    const formData = new FormData();
    formData.append('future_x', futureX);

    try {
      const response = await fetch('/predict', {
        method: 'POST',
        body: formData
      });

      if (!response.ok) {
        const errorText = await response.text();
        console.error("Predict error:", errorText);
        alert("Prediction failed: " + response.status);
        return;
      }

      const data = await response.json();

      document.getElementById('forecast').textContent =
        typeof data.forecast === "string"
          ? data.forecast
          : JSON.stringify(data.forecast, null, 2);
      document.getElementById('log').textContent = data.log;
      document.getElementById('plot').src = data.plot_url;
      document.getElementById('plot').style.display = 'block';

    } catch (err) {
      console.error("Unexpected prediction error:", err);
      alert("Prediction failed: " + err.message);
    }
  });
</script>
