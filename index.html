<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI DataScience Lab</title>
  <style>
    body {
      margin: 0;
      padding: 40px;
      font-family: 'Segoe UI', sans-serif;
      background: #f4f7f9;
      color: #333;
    }

    h1, h2 {
      text-align: center;
      margin-bottom: 5px;
    }

    h2 {
      font-weight: normal;
      font-size: 16px;
      color: #555;
    }

    h3 {
      margin-bottom: 10px;
    }

    .container {
      max-width: 900px;
      margin: auto;
    }

    .description {
      text-align: center;
      margin-top: 20px;
    }

    .section {
      margin-top: 30px;
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
      opacity: 0;
      transition: opacity 0.6s ease;
    }

    .section.visible {
      opacity: 1;
    }

    form {
      display: flex;
      flex-direction: column;
      max-width: 300px;
      margin-left: 0;
    }

    label {
      margin-bottom: 5px;
    }

    input[type="file"],
    input[type="text"],
    select {
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
      width: 100%;
    }

    button {
      width: fit-content;
      padding: 8px 16px;
      margin-bottom: 10px;
      border-radius: 6px;
      border: none;
      background-color: #0056d2;
      color: white;
      font-size: 14px;
      cursor: pointer;
    }

    button:hover {
      background-color: #0041a8;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background-color: #eee;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 20px;
      display: none;
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      transition: width 0.4s ease;
    }

    .green { background-color: #4CAF50; }
    .blue { background-color: #2196F3; }

    pre {
      white-space: pre-wrap;
      background: #f9f9f9;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      overflow-x: auto;
      font-size: 14px;
    }

    img {
      max-width: 100%;
      border-radius: 6px;
      border: 1px solid #ddd;
      margin-top: 10px;
    }

    .footer {
      text-align: center;
      font-size: 14px;
      color: #777;
      margin-top: 50px;
    }

    .footer a {
      color: #0056d2;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>AI-DataScience-Lab</h1>
    <h2>Built with Pandas, scikit-learn, and OpenAI GPT-3.5 API</h2>
    <h2>(<a href="https://github.com/Hariprashad-Ravikumar/AI-DataScience-Lab" target="_blank">View source code on Hari's GitHub</a>)</h2>

    <div class="description">
      <h3>Upload your data file to get forecast using AI</h3>
    </div>

    <div class="section visible">
      <form id="uploadForm">
        <label for="fileInput">Choose CSV File</label>
        <input type="file" id="fileInput" name="file" required />

        <button id="loadColumnsBtn" type="button">Upload</button>
        <div id="uploadProgress" class="progress-bar"><div class="progress-fill green" id="uploadFill"></div></div>

        <label for="xColumn" class="hidden">X Column</label>
        <select id="xColumn" name="x_column" class="hidden"></select>

        <label for="yColumn" class="hidden">Y Column</label>
        <select id="yColumn" name="y_column" class="hidden"></select>

        <button id="submitProcessing" class="hidden" type="submit">Submit for Processing</button>
        <div id="processProgress" class="progress-bar"><div class="progress-fill green" id="processFill"></div></div>
      </form>
    </div>

    <div class="section visible">
      <h3>Choose Regression</h3>
      <select id="regressionModel" name="model" disabled>
        <option value="linear">Linear Regression (More models soon...)</option>
      </select>
    </div>

    <div id="processingResults" class="section">
      <h3>Processing Log</h3>
      <pre id="log">Loading modules: pandas, scikit-learn, matplotlib...</pre>

      <h3>Data Summary (by OpenAI GPT-3.5 API)</h3>
      <pre id="summary"></pre>

      <h3>Model Performance</h3>
      <pre id="metrics"></pre>

      <h3>Scatter Plot</h3>
      <img id="plot" style="display:none;" alt="Scatter Plot" />

      <form id="predictForm">
        <label for="futureInput">Enter future values (comma-separated)</label>
        <input type="text" id="futureInput" name="future_x" />
        <button type="submit">Predict</button>
        <div id="predictProgress" class="progress-bar"><div class="progress-fill blue" id="predictFill"></div></div>
      </form>
    </div>

    <div id="forecastResults" class="section">
      <h3>Forecast Result</h3>
      <pre id="forecast"></pre>

      <h3>Forecast Visualization</h3>
      <img id="forecastPlot" style="display:none;" alt="Forecast Plot" />

      <a href="https://ai-dslab-backend-cpf2feachnetbbck.westus-01.azurewebsites.net/download-report" target="_blank">
        <button>Download PDF Report</button>
      </a>
    </div>

    <div class="footer">
      &copy; 2025 Hariprashad Ravikumar · All rights reserved<br>
      <a href="https://hariprashad-ravikumar.github.io" target="_blank">Website</a> · 
      <a href="https://github.com/Hariprashad-Ravikumar" target="_blank">GitHub</a>
    </div>
  </div>

  <script>
    const xColumn = document.getElementById('xColumn');
    const yColumn = document.getElementById('yColumn');
    const log = document.getElementById('log');
    const summary = document.getElementById('summary');
    const metrics = document.getElementById('metrics');
    const plot = document.getElementById('plot');
    const forecast = document.getElementById('forecast');
    const forecastPlot = document.getElementById('forecastPlot');
    const processingResults = document.getElementById('processingResults');
    const forecastResults = document.getElementById('forecastResults');

    document.getElementById('loadColumnsBtn').addEventListener('click', async () => {
      const file = document.getElementById('fileInput').files[0];
      if (!file) return alert("Please choose a file first.");

      document.getElementById('uploadProgress').style.display = 'block';
      document.getElementById('uploadFill').style.width = '30%';

      const formData = new FormData();
      formData.append('file', file);

      const res = await fetch('https://ai-dslab-backend-cpf2feachnetbbck.westus-01.azurewebsites.net/get-columns', {
        method: 'POST',
        body: formData
      });

      const data = await res.json();

      xColumn.innerHTML = yColumn.innerHTML = '';
      data.columns.forEach(col => {
        xColumn.innerHTML += `<option value="${col}">${col}</option>`;
        yColumn.innerHTML += `<option value="${col}">${col}</option>`;
      });

      xColumn.classList.remove('hidden');
      yColumn.classList.remove('hidden');
      xColumn.previousElementSibling.classList.remove('hidden');
      yColumn.previousElementSibling.classList.remove('hidden');
      document.getElementById('submitProcessing').classList.remove('hidden');

      document.getElementById('uploadFill').style.width = '100%';
      setTimeout(() => document.getElementById('uploadProgress').style.display = 'none', 500);
    });

    document.getElementById('uploadForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData();
      formData.append('file', document.getElementById('fileInput').files[0]);
      formData.append('x_column', xColumn.value);
      formData.append('y_column', yColumn.value);
      formData.append('model', 'linear');

      document.getElementById('processProgress').style.display = 'block';
      document.getElementById('processFill').style.width = '20%';

      const res = await fetch('https://ai-dslab-backend-cpf2feachnetbbck.westus-01.azurewebsites.net/upload', {
        method: 'POST',
        body: formData
      });

      const data = await res.json();

      document.getElementById('processFill').style.width = '100%';
      setTimeout(() => document.getElementById('processProgress').style.display = 'none', 500);

      summary.textContent = data.summary || '';
      log.textContent = data.log || '';
      metrics.textContent = `R² Score: ${data.r2_score}\nMSE: ${data.mse}`;
      plot.src = data.plot_url;
      plot.style.display = 'block';

      processingResults.classList.add('visible');
    });

    document.getElementById('predictForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData();
      formData.append('future_x', document.getElementById('futureInput').value);
      formData.append('x_column', xColumn.value);
      formData.append('y_column', yColumn.value);

      document.getElementById('predictProgress').style.display = 'block';
      document.getElementById('predictFill').style.width = '30%';

      const res = await fetch('https://ai-dslab-backend-cpf2feachnetbbck.westus-01.azurewebsites.net/predict', {
        method: 'POST',
        body: formData
      });

      const data = await res.json();

      document.getElementById('predictFill').style.width = '100%';
      setTimeout(() => document.getElementById('predictProgress').style.display = 'none', 500);

      forecast.textContent = typeof data.forecast === "string"
        ? data.forecast
        : JSON.stringify(data.forecast, null, 2);
      forecastPlot.src = data.forecast_plot_url + '?t=' + new Date().getTime();
      forecastPlot.style.display = 'block';

      forecastResults.classList.add('visible');
    });
  </script>
</body>
</html>
